{{ define "dashboard" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRAT C2 Agent Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/css/neon.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <header class="dashboard-header">
            <div class="logo">
                <h2>BRAT <span class="title-accent">C2</span></h2>
            </div>
            <div class="agent-info">
                <span class="cyber-status online" id="agent-status">ONLINE</span>
                <span class="agent-id" id="agent-id">{{ .agent.Name }}</span>
                <span class="last-seen" id="last-seen">Last seen: TODO</span>
            </div>
            <div class="nav-controls">
                <button id="back-to-main" href="/" class="btn btn-small">
                    <i class="fas fa-arrow-left btn-icon"></i> Back
                </button>
                <button id="refresh-agent" class="btn btn-small">
                    <i class="fas fa-sync btn-icon"></i> Refresh
                </button>
            </div>
        </header>
        
        <div class="dashboard-grid">
            <!-- Left Sidebar with Accordion Menu -->
            <div class="sidebar-menu">
                <!-- Agent Details Accordion -->
                <div class="accordion-section">
                    <div class="accordion-header" data-section="agent-details">
                        <h3>Agent Details</h3>
                        <i class="fas fa-chevron-down accordion-icon"></i>
                    </div>
                    <div class="accordion-content" id="agent-details-content">
                        <div class="detail-item">
                            <div class="detail-label">ID:</div>
                            <div class="detail-value" id="detail-id">{{ .agent.Name }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Source IP:</div>
                            <div class="detail-value" id="detail-ip">{{ .agent.SourceIP }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Type:</div>
                            <div class="detail-value" id="detail-type">{{ if .agent.IsStager }}Stager{{ else }}Full Agent{{ end }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">First Seen:</div>
                            <div class="detail-value" id="detail-created">{{ .agent.CreatedAt.Format "Jan 02, 2006 15:04:05" }}</div>
                        </div>
                        
                        <div class="cyberpunk-divider"></div>
                        
                        <div class="system-info" id="system-info">
                            <!-- This will be populated with parsed system info -->
                        </div>
                    </div>
                </div>

                <!-- Command Library Accordion -->
                <div class="accordion-section">
                    <div class="accordion-header" data-section="command-library">
                        <h3>Command Library</h3>
                        <i class="fas fa-chevron-down accordion-icon"></i>
                    </div>
                    <div class="accordion-content" id="command-library-content">
                        <div class="command-category">
                            <div class="category-header">Reconnaissance</div>
                            <div class="command-list">
                                <div class="command-item" data-command="collect_browser_info">Collect Browser Info</div>
                                <div class="command-item" data-command="scan_local_network">Scan Local Network</div>
                                <div class="command-item" data-command="capture_cookies">Capture Cookies</div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <div class="category-header">Persistence</div>
                            <div class="command-list">
                                <div class="command-item" data-command="install_service_worker">Install Service Worker</div>
                                <div class="command-item" data-command="create_local_storage">Create Local Storage</div>
                                <div class="command-item" data-command="upgrade_agent">Upgrade Agent</div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <div class="category-header">Data Collection</div>
                            <div class="command-list">
                                <div class="command-item" data-command="take_screenshot">Take Screenshot</div>
                                <div class="command-item" data-command="keylogger_start">Start Keylogger</div>
                                <div class="command-item" data-command="form_harvester">Form Harvester</div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <div class="category-header">Control</div>
                            <div class="command-list">
                                <div class="command-item" data-command="sleep 10">Sleep (10s)</div>
                                <div class="command-item" data-command="terminate">Terminate Agent</div>
                                <div class="command-item" data-command="exfiltrate_data">Exfiltrate Data</div>
                            </div>
                        </div>

                        <div class="command-category">
                            <div class="category-header">Attacks</div>
                            <div class="command-list">
                                <div class="command-item" id='remote-view' data-command="attacks.remote_view">Remote View</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Command Console Panel (Right Side) -->
            <div class="panel command-console">
                <div class="panel-header">
                    <h3>Command Console</h3>
                    <div class="panel-actions">
                        <button id="command-history-btn" class="btn btn-small">
                            <i class="fas fa-history btn-icon"></i> Command History
                        </button>
                        <button id="clear-all-commands" class="btn btn-small danger">
                            <span class="btn-icon">⚠️</span> Clear All Commands
                        </button>
                        <button id="remote-view-panel" class="btn btn-small info">
                            Remote View Panel
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="console-output" id="console-output">
                        <div class="console-line system-message">
                            <span class="timestamp">{{ .now.Format "15:04:05" }}</span>
                            <span class="message-content">Connection established to agent {{ .agent.Name }}</span>
                        </div>
                        <div class="console-line system-message">
                            <span class="timestamp">{{ .now.Format "15:04:05" }}</span>
                            <span class="message-content">Type a command below and press Enter or select a command from the Command Library</span>
                        </div>
                    </div>
                    <div class="console-input-container">
                        <span class="console-prompt">></span>
                        <input type="text" id="command-input" class="console-input" placeholder="Enter command..." autofocus>
                    </div>
                </div>
            </div>
        </div>
            
            <!-- Activity Log Panel -->
            <div class="panel activity-log">
                <div class="panel-header">
                    <h3>Activity Log</h3>
                    <button id="clear-log" class="btn btn-small">
                        <i class="fas fa-trash btn-icon"></i> Clear
                    </button>
                </div>
                <div class="panel-content">
                    <table class="neon-table">
                        <thead>
                            <tr>
                                <th width="20%">Timestamp</th>
                                <th width="20%">Type</th>
                                <th width="60%">Activity</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table-body">
                            <tr>
                                <td>TODO</td>
                                <td><span class="activity-type connection">CONNECTION</span></td>
                                <td>Agent dashboard opened</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Remote View Modal -->
    <div id="remote-view-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Remote View</h2>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-toolbar">
                <div class="view-info">
                    <span id="remote-view-url">URL: </span>
                    <span id="remote-view-timestamp">Timestamp: </span>
                </div>
                <div class="view-controls">
                    <button id="refresh-remote-view" class="btn btn-small">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button id="stop-remote-view" class="btn btn-small danger">
                        <i class="fas fa-stop"></i> Stop
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="iframe-container">
                    <iframe id="remote-view-iframe" sandbox="allow-same-origin" srcdoc="<html><body><p>Loading remote view...</p></body></html>"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Command History Modal -->
    <div id="command-history-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2><i class="fas fa-history"></i> Command History</h2>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-toolbar">
                <div class="view-info">
                    <span id="command-count">Total Commands: 0</span>
                    <span id="last-updated">Last Updated: --</span>
                </div>
                <div class="view-controls">
                    <button id="refresh-command-history" class="btn btn-small">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button id="clear-command-history" class="btn btn-small danger">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="command-history-container">
                    <table class="neon-table command-history-table">
                        <thead>
                            <tr>
                                <th width="15%">Time</th>
                                <th width="25%">Command</th>
                                <th width="15%">Status</th>
                                <th width="45%">Response</th>
                            </tr>
                        </thead>
                        <tbody id="command-history-table-body">
                            <tr>
                                <td colspan="4" style="text-align: center; color: var(--cyberpunk-accent); padding: 20px;">
                                    <i class="fas fa-spinner fa-spin"></i> Loading command history...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script>
        // Initialize dashboard with agent ID
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard('{{ .agent.Name }}');
        });
    </script>
</body>
</html>
{{ end }}